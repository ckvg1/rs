<!DOCTYPE html>
<html lang="pl">
  <head>
    <script src="axios.min.js"></script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sterowanie</title>

    <link rel="icon" type="image/x-icon" href="icon.png" />
    <style>
      body {
        font-family: "Courier New", Courier, monospace;
        background-color: #d3e2ec;
      }

      button {
        background-color: #2a80f9;
        color: white;
        padding: 12px 24px;
        font-size: 16px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        box-shadow: 0 4px 4px rgba(0, 0, 0, 0.1);
      }
      .temperatura {
        font-weight: bold;
        font-size: 16pt;
      }
    </style>
  </head>
  <body
    style="
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      gap: 0px;
    "
  >
    <header><img src="../logo.svg" /></header>
    <h1>Sterowanie urządzeniami</h1>

    <div
      style="display: flex; flex-direction: row; gap: 15px; align-items: center"
    >
      <h2>Zobacz dane</h2>
      <a href="../wykresy/swiatla.html">
        <button>Światła</button>
      </a>
      <a href="../wykresy/temperatura.html">
        <button>Temperatura</button>
      </a>
    </div>
    <div
      id="myDiv"
      class="main_image"
      style="
        width: 1118px;
        height: 745px;
        background-image: url('swiatla-bg.png');
        position: relative;
      "
    >
      <a onmousedown="wyslijTrue('swiatlo1_1')" style="cursor: pointer">
        <img
          id="swiatlo1_1"
          src="bulb_on.png "
          style="width: 4%; position: absolute; top: 25%; left: 17%"
        />
      </a>
      <div
        class="temperatura"
        id="temperatura1"
        style="position: absolute; top: 21%; left: 19%"
      >
        35 *C
      </div>
      <a onmousedown="wyslijTrue('swiatlo1_2')" style="cursor: pointer">
        <img
          id="swiatlo1_2"
          src="bulb_on.png "
          style="width: 4%; position: absolute; top: 25%; left: 22%"
        />
      </a>

      <a onmousedown="wyslijTrue('swiatlo2_1')" style="cursor: pointer">
        <img
          id="swiatlo2_1"
          src="bulb_on.png "
          style="width: 4%; position: absolute; top: 29%; left: 53%"
        />
      </a>
      <div
        class="temperatura"
        id="temperatura2"
        style="position: absolute; top: 24%; left: 54%"
      >
        25 *C
      </div>
      <a onmousedown="wyslijTrue('swiatlo2_2')" style="cursor: pointer">
        <img
          id="swiatlo2_2"
          src="bulb_on.png "
          style="width: 4%; position: absolute; top: 29%; left: 58%"
        />
      </a>

      <a onmousedown="wyslijTrue('swiatlo3_1')" style="cursor: pointer">
        <img
          id="swiatlo3_1"
          src="bulb_on.png "
          style="width: 4%; position: absolute; top: 29%; left: 71%"
        />
      </a>
      <div
        class="temperatura"
        id="temperatura3"
        style="position: absolute; top: 24%; left: 73%"
      >
        17 *C
      </div>
      <a onmousedown="wyslijTrue('swiatlo3_2')" style="cursor: pointer">
        <img
          id="swiatlo3_2"
          src="bulb_on.png "
          style="width: 4%; position: absolute; top: 29%; left: 76%"
        />
      </a>

      <a onmousedown="wyslijTrue('swiatlo4_1')" style="cursor: pointer">
        <img
          id="swiatlo4_1"
          src="bulb_on.png "
          style="width: 4%; position: absolute; top: 71%; left: 17%"
        />
      </a>
      <div
        class="temperatura"
        id="temperatura4"
        style="position: absolute; top: 65%; left: 18%"
      >
        22 *C
      </div>
      <a onmousedown="wyslijTrue('swiatlo4_2')" style="cursor: pointer">
        <img
          id="swiatlo4_2"
          src="bulb_on.png "
          style="width: 4%; position: absolute; top: 71%; left: 22%"
        />
      </a>

      <a onmousedown="wyslijTrue('swiatlo5_1')" style="cursor: pointer">
        <img
          id="swiatlo5_1"
          src="bulb_on.png "
          style="width: 4%; position: absolute; top: 68%; left: 37%"
        />
      </a>
      <div
        class="temperatura"
        id="temperatura5"
        style="position: absolute; top: 62%; left: 39%"
      >
        19 *C
      </div>
      <a onmousedown="wyslijTrue('swiatlo5_2')" style="cursor: pointer">
        <img
          id="swiatlo5_2"
          src="bulb_on.png "
          style="width: 4%; position: absolute; top: 68%; left: 42%"
        />
      </a>

      <a onmousedown="wyslijTrue('swiatlo6_1')" style="cursor: pointer">
        <img
          id="swiatlo6_1"
          src="bulb_on.png "
          style="width: 4%; position: absolute; top: 68%; left: 53%"
        />
      </a>
      <div
        class="temperatura"
        id="temperatura6"
        style="position: absolute; top: 62%; left: 55%"
      >
        27 *C
      </div>
      <a onmousedown="wyslijTrue('swiatlo6_2')" style="cursor: pointer">
        <img
          id="swiatlo6_2"
          src="bulb_on.png "
          style="width: 4%; position: absolute; top: 68%; left: 58%"
        />
      </a>

      <a onmousedown="wyslijTrue('swiatlo7_1')" style="cursor: pointer">
        <img
          id="swiatlo7_1"
          src="bulb_on.png "
          style="width: 4%; position: absolute; top: 68%; left: 71%"
        />
      </a>
      <a onmousedown="wyslijTrue('swiatlo7_2')" style="cursor: pointer">
        <img
          id="swiatlo7_2"
          src="bulb_on.png "
          style="width: 4%; position: absolute; top: 68%; left: 76%"
        />
      </a>
      <div
        class="temperatura"
        id="temperatura7"
        style="position: absolute; top: 62%; left: 73%"
      >
        20 *C
      </div>
    </div>

    <script>
      //const axios = require("axios/dist/browser/axios.cjs");
      let temperatureLoaded = false;
      addEventListener("DOMContentLoaded", (event) => {
        pobierzDaneSwiatlo();

        //pobierzDaneTemp();
      });
      //pobierzDaneTemp();
      setInterval(pobierzDaneTemp, 10000);
      setInterval(pobierzDaneSwiatlo, 100);
      function pobierzDaneSwiatlo() {
        axios
          .get("http://192.168.0.18:3000/swiatla/wyjscia")
          .then((response) => {
            const dane = response.data;
            //console.log(Object.entries(dane));
            Object.entries(dane).forEach(([id, wartosc]) => {
              const przycisk = document.getElementById(id.slice(8));
              if (przycisk) {
                //console.log(przycisk);
                przycisk.setAttribute(
                  "src",
                  wartosc ? "bulb_on.png" : "bulb_of.png"
                );
              } else {
                //console.log("nie ma takiego przycisku ", przycisks);
              }
            });
          })
          .then(() => {
            if (!temperatureLoaded) pobierzDaneTemp();
            temperatureLoaded = true;
          })
          .catch((error) => {
            console.error("Błąd pobierania danych o swiatlach:", error);
          });
      }
      function pobierzDaneTemp() {
        axios
          .get("http://192.168.0.18:3000/temperatura")
          .then((response) => {
            const dane = response.data;
            console.log("Pobrano dane o temperaturze:", response);
            Object.entries(dane).forEach(([id, wartosc]) => {
              const przycisk = document.getElementById(id);
              if (przycisk) {
                przycisk.innerHTML = `${wartosc.toFixed(1)} *C`;
              } else {
                console.log("Nie ma takiego diva z temperatura lol", id);
              }
            });
          })
          .catch((error) => {
            console.error("Blad pobierania danych o temperaturze", error);
          });
      }
      function wyslijTrue(swiatlo) {
        axios
          .put(`http://192.168.0.18:3000/swiatla/${swiatlo}`, {
            wartosc: true,
          })
          .then((response) => {
            // console.log("Odpowiedź:", response.data);
          })
          .then(() => {
            axios
              .put(`http://192.168.0.18:3000/swiatla/${swiatlo}`, {
                wartosc: false,
              })
              .then((response) => {
                //console.log("Odpowiedź:", response.data);
                pobierzDaneSwiatlo();
              })
              .catch((error) => {
                console.error("Błąd:", error);
              });
          })
          .catch((error) => {
            console.error("Błąd:", error);
          });
      }

      //function wyslijFalse(swiatlo) {}
    </script>
  </body>
</html>
