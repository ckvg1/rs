const dictionary = {
  de: {
    "Wyłącz automatycznie wszystkie światła o:":
      "Schalte alle Lichter automatisch aus um:",
    "Błąd połączenia z PLC": "Verbindungsfehler zum PLC",
    "Błąd połączenia z bazą danych": "Verbindungsfehler zur Datenbank",
    "Zmieniaj nazwy czujników i pomieszczeń":
      "Ändere die Namen von Sensoren und Räumen",
    "Wyłącz wszystkie światła": "Schalte alle Lichter aus ",
    "Włącz wszystkie światła": "Schalte alle Lichter ein",
    "w firmie": "im Unternehmen",
    "w mieszkaniu": "in der Wohnung",
    "Pobierz miesięczny raport temperatury":
      "Lade den monatlichen Temperaturbericht herunter",
    "Pobierz miesięczny raport światła":
      "Lade den monatlichen Lichtbericht herunter",
    "używam danych z: ": "Ich verwende Daten von: ",
    "Brak danych do wyświetlenia wykresu. Proszę podać daty pomiaru.":
      "Keine Daten zum Anzeigen des Diagramms. Bitte geben Sie die Messdaten an.",
    "Wybierz daty pomiaru": "Wählen Sie die Messdaten aus",
    "wybierz zakres dat": "Wählen Sie den Datumsbereich",
    "od-do": "von-bis",
    "wykonania pomiaru": "Messung durchgeführt am",
    "Trwa łączenie z PLC.": "Verbindung zum PLC wird hergestellt.",
    "Sterowanie urządzeniami": "Steuerung von Geräten",
    "spróbuj ponownie": "Versuchen Sie es erneut",
    "Nie udało się połączyć z serwerem.":
      "Verbindung zum Server konnte nicht hergestellt werden.",

    Ustawienia: "Einstellungen",
    Temperatura: "Temperatur",
    Światło: "Licht",
    Biuro: "Büro",
    Statystyki: "Statistiken",
    piętro: "Stock",
    harmonogram: "Zeitplan",
    raporty: "Berichte",
    filtruj: "Filter",
    Wszystkie: "alle",
    piętra: "Etagen",
    ostatnie: "Letzte",
    godziny: "Stunden",
    "brak danych": "Keine Daten",
    Data: "Datum",
    Zapisz: "Speichern",
    dni: "tagen",
    uwaga: "Achtung",
  },
  uk: {
    "Wyłącz automatycznie wszystkie światła o:":
      "Turn off all lights automatically at:",
    "Błąd połączenia z PLC": "Connection error to PLC",
    "Błąd połączenia z bazą danych": "Connection error to database",
    "Zmieniaj nazwy czujników i pomieszczeń":
      "Change names of sensors and rooms",
    "Wyłącz wszystkie światła": "Turn off all lights ",
    "Włącz wszystkie światła": "Turn on all lights",
    "w firmie": "in the company",
    "Pobierz miesięczny raport temperatury":
      "Download monthly temperature report",
    "Pobierz miesięczny raport światła": "Download monthly light report",
    "używam danych z: ": "I use data from: ",
    "Brak danych do wyświetlenia wykresu. Proszę podać daty pomiaru.":
      "No data to display the chart. Please provide measurement dates.",
    "Wybierz daty pomiaru": "Select measurement dates",
    "wybierz zakres dat": "Select date range",
    "od-do": "from-to",
    "wykonania pomiaru": "measurement performed on",
    "Trwa łączenie z PLC.": "Connecting to PLC.",
    "Sterowanie urządzeniami": "Device control",
    "spróbuj ponownie": "try again",
    "Nie udało się połączyć z serwerem.": "Connection to the server failed.",
    Ustawienia: "Settings",
    Temperatura: "Temperature",
    Światło: "Light",
    Biuro: "Office",
    Statystyki: "Statistics",
    piętro: "floor",
    harmonogram: "schedule",
    raporty: "reports",
    filtruj: "filter",
    Wszystkie: "All",
    piętra: "floors",
    ostatnie: "top",
    godziny: "hours",
    "brak danych": "no data",
    Data: "Date",
    Zapisz: "Save",
    dni: "days",
    uwaga: "Warning",
  },
  si: {
    "Wyłącz automatycznie wszystkie światła o:":
      "Wyłōncz autōmatycznie wszystke światła ô:",
    "Błąd połączenia z PLC": "Błōnd połōnczynia ze PLC",
    "Błąd połączenia z bazą danych": "Błōnd połōnczynia ze bazōm danych",
    "Zmieniaj nazwy czujników i pomieszczeń": "Zmiyniej nazwy kneflōw i izbōw",
    "Wyłącz wszystkie światła": "Wyłōncz wszystke światła ",
    "Włącz wszystkie światła": "Włōncz wszystke światła",
    "w firmie": "we firmie",
    "w mieszkaniu": "we chałpie",
    "Pobierz miesięczny raport temperatury":
      "Pobier miesiynczny raport tymperatury",
    "Pobierz miesięczny raport światła": "Pobier miesiynczny raport światła",
    "używam danych z: ": "używōm danych ze: ",
    "Brak danych do wyświetlenia wykresu. Proszę podać daty pomiaru.":
      "Brak danych do wyświytlynia wykresu. Prosza podać kedy bōło mierzone.",
    "Wybierz daty pomiaru": "Wybier kedy bōło mierzone",
    "wybierz zakres dat": "Wybier zakres dat",
    "od-do": "ôd-do",
    "wykonania pomiaru": "mierzynia",
    "Trwa łączenie z PLC.": "Trwŏ łōnczynie ze PLC",
    "Sterowanie urządzeniami": "Panel ze kneflōma",
    "spróbuj ponownie": "sprōbōj jeszcze rŏz",
    "Nie udało się połączyć z serwerem.": "Niy ma połōnczynŏ ze serwerym.",
    Ustawienia: "Ustawiynia",
    Temperatura: "Tymperatura",
    Światło: "Światło",
    Biuro: "Biōro",
    Statystyki: "Statystyki",
    piętro: "piyntro",
    harmonogram: "ôrganizacja",
    raporty: "raporty",
    filtruj: "klarōj",
    Wszystkie: "wszystke",
    piętra: "piyntra",
    ostatnie: "ôstatnie",
    godziny: "godziny",
    "brak danych": "brak danych",
    Data: "Data",
    Zapisz: "Zapisz",
    dni: "dni",
    uwaga: "Pozor",
  },
};

function preserveCase(match, val) {
  // Cały tekst wielkimi literami?
  if (match === match.toUpperCase()) {
    return val.toUpperCase();
  }
  // Tylko pierwsza litera wielka?
  if (match[0] === match[0].toUpperCase()) {
    return val.charAt(0).toUpperCase() + val.slice(1);
  }
  // Pozostaw w oryginalnym kształcie
  return val;
}

function translatePage(lang) {
  if (lang === "pl") {
    return; // język bazowy
  }

  document.querySelectorAll("body *:not(script):not(style)").forEach((el) => {
    el.childNodes.forEach((node) => {
      if (node.nodeType !== Node.TEXT_NODE) return;

      let originalText = node.nodeValue;
      let normalized = originalText
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "");

      for (const [key, val] of Object.entries(dictionary[lang])) {
        const normalizedKey = key
          .toLowerCase()
          .normalize("NFD")
          .replace(/[\u0300-\u036f]/g, "");

        if (!normalized.includes(normalizedKey)) continue;

        // Escape znaków specjalnych w kluczu
        const escKey = key.replace(/[-\/\\^$*+?.()|[\]{}]/g, "\\$&");
        const regex = new RegExp(escKey, "gi");

        originalText = originalText.replace(regex, (match) =>
          preserveCase(match, val)
        );
      }

      node.nodeValue = originalText;
    });
  });
}

function getCookie(cname) {
  let name = cname + "=";
  let decodedCookie = decodeURIComponent(document.cookie);
  let ca = decodedCookie.split(";");
  for (let i = 0; i < ca.length; i++) {
    let c = ca[i].trim();
    if (c.indexOf(name) === 0) {
      return c.substring(name.length);
    }
  }
  return "";
}

document.addEventListener("DOMContentLoaded", function () {
  //console.log("DOM załadowany, tłumaczenie strony");
  const lang = getCookie("lang") || "pl";
  translatePage(lang);
});

// Obsługa przycisków zmiany języka
document.querySelectorAll(".language-button").forEach((button) => {
  button.addEventListener("click", () => {
    const lang = button.getAttribute("data-lang");
    translatePage(lang);
  });
});
